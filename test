import tkinter as tk
from tkinter import messagebox

# CCITT-16 CRC ê³„ì‚° í•¨ìˆ˜
def ccitt16_crc(data: bytes) -> int:
    crc = 0xFFFF
    for byte in data:
        crc ^= byte << 8
        for _ in range(8):
            if crc & 0x8000:
                crc = (crc << 1) ^ 0x1021
            else:
                crc <<= 1
            crc &= 0xFFFF  # 16-bit ìœ ì§€
    return crc

# Add Sum ê³„ì‚° í•¨ìˆ˜
def add_sum(data: bytes) -> int:
    return sum(data) & 0xFF  # 1ë°”ì´íŠ¸ ê°’ ìœ ì§€

# Exclusive OR (XOR) ê³„ì‚° í•¨ìˆ˜
def xor_sum(data: bytes) -> int:
    result = 0
    for byte in data:
        result ^= byte
    return result

# ë°”ì´íŠ¸ ì…ë ¥ í•„ë“œ ì¶”ê°€ í•¨ìˆ˜
def add_byte_field(group_frame, byte_entries):
    entry = tk.Entry(group_frame, width=4, justify="center")
    entry.grid(row=0, column=len(byte_entries) + 1, padx=2, pady=2)
    byte_entries.append(entry)

# ì…ë ¥ ê·¸ë£¹ ì¶”ê°€ í•¨ìˆ˜
def add_input_group():
    group_frame = tk.Frame(frame)
    group_frame.pack(pady=5, fill="x")

    label = tk.Label(group_frame, text=f"ì…ë ¥ {len(input_groups) + 1}:")
    label.grid(row=0, column=0, padx=5)

    byte_entries = []
    add_byte_field(group_frame, byte_entries)  # ê¸°ë³¸ 1ë°”ì´íŠ¸ ì…ë ¥ ì¶”ê°€

    add_byte_button = tk.Button(group_frame, text="+ ë°”ì´íŠ¸ ì¶”ê°€", command=lambda: add_byte_field(group_frame, byte_entries))
    add_byte_button.grid(row=0, column=len(byte_entries) + 1, padx=5)

    input_groups.append(byte_entries)

# ì…ë ¥ê°’ ë³€í™˜ ë° ê²°ê³¼ ì¶œë ¥
def process_input():
    results = []
    
    for byte_entries in input_groups:
        byte_values = []
        for entry in byte_entries:
            value = entry.get().strip()
            if value:  # ë¹ˆ ê°’ ë¬´ì‹œ
                try:
                    byte_values.append(int(value, 16))
                except ValueError:
                    messagebox.showerror("ì˜¤ë¥˜", f"ì˜ëª»ëœ ë°”ì´íŠ¸ ì…ë ¥: {value}")
                    return

        if not byte_values:
            continue

        data_bytes = bytes(byte_values)

        # ì„ íƒëœ ì²´í¬ì„¬ ë°©ì‹ ê³„ì‚°
        if checksum_var.get() == "ADD_SUM":
            checksum_result = add_sum(data_bytes)
            checksum_label = "ADD_SUM"
        elif checksum_var.get() == "XOR":
            checksum_result = xor_sum(data_bytes)
            checksum_label = "XOR"
        elif checksum_var.get() == "CRC16":
            checksum_result = ccitt16_crc(data_bytes)
            checksum_label = "CRC16"

        # ê²°ê³¼ ë°ì´í„° í¬ë§·
        hex_values = " ".join(f"{b:02X}" for b in data_bytes)
        final_output = f"{hex_values} | {checksum_label}: {checksum_result:02X}"
        results.append(final_output)
    
    # ê²°ê³¼ ì¶œë ¥
    if results:
        output_label.config(text="ê²°ê³¼:\n" + "\n".join(results))
    else:
        output_label.config(text="ê²°ê³¼: ì…ë ¥ëœ ê°’ì´ ì—†ìŠµë‹ˆë‹¤.")

# UI ì„¤ì •
root = tk.Tk()
root.title("ì²´í¬ì„¬ ì„ íƒ ë°ì´í„° ë³€í™˜ê¸°")

frame = tk.Frame(root, padx=10, pady=10)
frame.pack(padx=10, pady=10)

# ì²´í¬ì„¬ ë°©ì‹ ì„ íƒ
checksum_var = tk.StringVar(value="ADD_SUM")

checksum_frame = tk.LabelFrame(frame, text="ì²´í¬ì„¬ ë°©ì‹ ì„ íƒ", padx=10, pady=5)
checksum_frame.pack(pady=5, fill="x")

tk.Radiobutton(checksum_frame, text="ADD_SUM", variable=checksum_var, value="ADD_SUM").pack(anchor="w")
tk.Radiobutton(checksum_frame, text="XOR", variable=checksum_var, value="XOR").pack(anchor="w")
tk.Radiobutton(checksum_frame, text="CRC16", variable=checksum_var, value="CRC16").pack(anchor="w")

# ì…ë ¥ ê·¸ë£¹ ì¶”ê°€ ë²„íŠ¼
add_group_button = tk.Button(frame, text="ì…ë ¥ ì¶”ê°€", command=add_input_group)
add_group_button.pack(pady=5)

# ì…ë ¥ ê·¸ë£¹ ë¦¬ìŠ¤íŠ¸
input_groups = []
add_input_group()  # ê¸°ë³¸ 1ê°œì˜ ì…ë ¥ ê·¸ë£¹ ì¶”ê°€

# ë³€í™˜ ë²„íŠ¼
process_button = tk.Button(frame, text="ë³€í™˜", command=process_input)
process_button.pack(pady=10)

# ê²°ê³¼ ì¶œë ¥
output_label = tk.Label(frame, text="ê²°ê³¼: ", fg="blue", font=("Arial", 12), justify="left")
output_label.pack(pady=5)

root.mainloop()





class ConsoleApp:
    def __init__(self):
        """ë©”ë‰´ ì„¤ì •"""
        self.menu_stack = []  # âœ… ë©”ë‰´ ì´ë™ ê¸°ë¡ (ìƒìœ„ ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸° ìš©ë„)
        self.main_menu = {
            "1": ("ì„œë¸Œ ë©”ë‰´ 1", self.sub_menu_1),
            "2": ("ì„œë¸Œ ë©”ë‰´ 2", self.sub_menu_2),
            "exit": ("í”„ë¡œê·¸ë¨ ì¢…ë£Œ", None),
        }

    def run(self):
        """í”„ë¡œê·¸ë¨ ì‹¤í–‰ (ë©”ì¸ ë©”ë‰´ í‘œì‹œ)"""
        self.menu_stack.append(self.main_menu)  # âœ… ì²˜ìŒ ì‹¤í–‰ ì‹œ ë©”ì¸ ë©”ë‰´ë¥¼ ìŠ¤íƒì— ì¶”ê°€
        self.show_menu()

    def show_menu(self):
        """í˜„ì¬ ë©”ë‰´ í‘œì‹œ ë° ì…ë ¥ ì²˜ë¦¬"""
        while self.menu_stack:
            current_menu = self.menu_stack[-1]  # âœ… í˜„ì¬ ë©”ë‰´ ê°€ì ¸ì˜¤ê¸°
            print("\n=== [ë©”ë‰´] ===")
            for key, (desc, _) in current_menu.items():
                print(f"{key}. {desc}")

            choice = input("ğŸ‘‰ ì„ íƒ: ").strip().lower()

            if choice in current_menu:
                if choice == "exit":  # âœ… í”„ë¡œê·¸ë¨ ì¢…ë£Œ
                    print("ğŸ‘‹ í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.")
                    break
                else:
                    _, action = current_menu[choice]
                    if action:
                        action()  # âœ… ì„ íƒí•œ ë©”ë‰´ í•¨ìˆ˜ ì‹¤í–‰
            elif choice == "back" and len(self.menu_stack) > 1:
                self.menu_stack.pop()  # âœ… ìƒìœ„ ë©”ë‰´ë¡œ ì´ë™
                print("ğŸ”¼ ìƒìœ„ ë©”ë‰´ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.")
            else:
                print("âš ï¸ ì˜¬ë°”ë¥¸ ì…ë ¥ì´ ì•„ë‹™ë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”.")

    def sub_menu_1(self):
        """ì„œë¸Œ ë©”ë‰´ 1"""
        menu = {
            "1": ("ì„œë¸Œ ëª…ë ¹ì–´ 1-1 ì‹¤í–‰", lambda: print("âœ… ì„œë¸Œ ëª…ë ¹ì–´ 1-1 ì‹¤í–‰ ì™„ë£Œ!")),
            "2": ("ì„œë¸Œ ëª…ë ¹ì–´ 1-2 ì‹¤í–‰", lambda: print("âœ… ì„œë¸Œ ëª…ë ¹ì–´ 1-2 ì‹¤í–‰ ì™„ë£Œ!")),
            "back": ("ìƒìœ„ ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°", None),
        }
        self.menu_stack.append(menu)  # âœ… ì„œë¸Œ ë©”ë‰´ì— ì§„ì…í•˜ë©´ ë©”ë‰´ ìŠ¤íƒì— ì¶”ê°€
        self.show_menu()

    def sub_menu_2(self):
        """ì„œë¸Œ ë©”ë‰´ 2"""
        menu = {
            "1": ("ì„œë¸Œ ëª…ë ¹ì–´ 2-1 ì‹¤í–‰", lambda: print("âœ… ì„œë¸Œ ëª…ë ¹ì–´ 2-1 ì‹¤í–‰ ì™„ë£Œ!")),
            "2": ("ì„œë¸Œ ëª…ë ¹ì–´ 2-2 ì‹¤í–‰", lambda: print("âœ… ì„œë¸Œ ëª…ë ¹ì–´ 2-2 ì‹¤í–‰ ì™„ë£Œ!")),
            "back": ("ìƒìœ„ ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°", None),
        }
        self.menu_stack.append(menu)
        self.show_menu()


if __name__ == "__main__":
    app = ConsoleApp()
    app.run()

